<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="dan24678/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="dan24678/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="dan24678/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="dan24678/">Home</a>
        
          <a class="main-nav-link" href="dan24678/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="dan24678/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Useless-Stuff-I-Still-Know" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="dan24678/2019/12/12/Useless-Stuff-I-Still-Know/" class="article-date">
  <time datetime="2019-12-12T14:41:52.000Z" itemprop="datePublished">2019-12-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="dan24678/2019/12/12/Useless-Stuff-I-Still-Know/">Useless Stuff I Still Know</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I’ve been doing Web Development since about 2002. In many ways, things are not all that different today than they were 17 years ago. Many of the problems I work on in my current job are similar to those I worked on almost 2 decades ago when I first learned Javascript by making an insurance calculator for the financial services company I worked for at the time.</p>
<p>But, while many of the higher-level concepts and core technologies have been around for all this time, there are numerous quirks and behaviors associated with the earlier versions of Internet Explorer, Netscape Navigator, and the first versions of Firefox that simply have no relevance today.</p>
<p>Those latter pieces of useless, arcane lore are the purpose of this blog post. Here are some of the behaviors, code and bugs that I had to deal with when I was first getting started in this industry. Most of this info is so outdated that knowing this stuff is of no practical use today. But it’s fun to reminisce.</p>
<h2 id="12-lt-marquee-gt-Tags"><a href="#12-lt-marquee-gt-Tags" class="headerlink" title="#12: &lt;marquee&gt; Tags"></a>#12: <code>&lt;marquee&gt;</code> Tags</h2><p>This one makes the top of the list, since it is arguably still somewhat relevant. The marquee tag lets you easily make a box of scrolling text:</p>
<marquee>This just in!! The Americans have bombed Sesame Street. There are reports of massive muppet casualties. Stay tuned for more information at the top of the hour.</marquee>

<p>The <a href="https://caniuse.com/#search=marquee" target="_blank" rel="noopener">CanIUse page</a> for this one has an interesting tidbit. While this tag is non-standard and deprecated, it has universal support in all current browsers – as a result of Firefox finally adding support for this tag in January, 2019 after not supporting it for 13 years!</p>
<p>Oddly, I would bet that more people know about the infamous <blink>blink tag</blink> (which hasn’t worked in a browser since 2013) than know about <code>&lt;marquee&gt;</code>, which still works to this day.</p>
<h2 id="11-Frames"><a href="#11-Frames" class="headerlink" title="#11: Frames"></a>#11: Frames</h2><p>I’m sure that all web developers are familiar with frames. But I don’t think they all appreciate the nuances of the history around their usage in web development.</p>
<p>First, it’s important to understand the problem that they were introduced to solve.</p>
<p>Backend web-centric programming languages like PHP did not exist back in the day. There were certainly ways to use code to programmatically generate HTML – mainly throught CGI code written in Perl or C, or Server-Side Includes in Apache – but these were too complicated and difficult to use for simple tasks.</p>
<p>That’s where frames came in. If you wanted to have a menu on your website and have the same menu appear on twenty different pages, you had two choices. You could copy and paste the menu 20 times; or you could separate the menu from the rest of your pages and put it in a frame.</p>
<p>I can also remember doing some projects in the editor Dreamweaver, which let you define reusable templates, such as a “menu”. It would let you change the menu template and then automatically upload the modified versions of all 20 pages that included your inlined menu HTML.</p>
<p>These days frames are mostly known for their once obscure cousin, the <code>&lt;iframe&gt;</code>. It’s funny to look back and remember a time when regular frames were widespread, and iframes almost unheard of. </p>
<h2 id="10-Image-Maps"><a href="#10-Image-Maps" class="headerlink" title="#10: Image Maps"></a>#10: Image Maps</h2><p>The <code>&lt;map&gt;</code> tag lets you take a single image and section if off into various links. So you can take a map of the United States in a single image and make each state clickable to take you to a different URL.</p>
<p>It looks like the <code>&lt;map&gt;</code> tag is still supported today, and not even deprecated. Their biggest use case today is probably in HTML emails, since email clients and rendering are somewhat frozen in time and lag a decade behind the rest of the Internet.</p>
<p>The interesting thing here is that there really isn’t a better alternative to the <code>&lt;map&gt;</code> tag when you want to do this sort of thing quickly. So the tag didn’t fade from the public eye because there was a better way to do it. It seems to have gone away because designers just stopped using clickable maps as a means of navigation. Honestly, it’s weird to see how such a niche thing caught on and got so popular in the first place.</p>
<h2 id="9-Netscape-Layers"><a href="#9-Netscape-Layers" class="headerlink" title="#9: Netscape Layers"></a>#9: Netscape Layers</h2><p>Okay! Now, we’re getting into the good stuff.</p>
<p>Back in the early days of the Browser Wars when Netscape Navigator reigned supreme and Internet Explorer 3 and 4 were nipping at its heels, CSS was still in its infancy. You could do basic stuff, but there was no concept of z-index.</p>
<p>Netscape introduced their own method of positioning overlapping arbitrary elements called “layers”. It was confusing and did not get much traction. It was pretty quickly abandoned in favor of z-index and the related positioning properties in CSS version 2.</p>
<p>But, if you search on the Web for “Netscape Layers” there is still plenty of information on them to be found. The brief <a href="https://en.wikipedia.org/wiki/Layer_element" target="_blank" rel="noopener">wikipedia layer_element entry</a> has some interesting tidbits, including how “document.layers” was an early browser-sniffing technique to find Navigator.</p>
<h2 id="8-Select-Boxes-in-IE6"><a href="#8-Select-Boxes-in-IE6" class="headerlink" title="#8: Select Boxes in IE6"></a>#8: Select Boxes in IE6</h2><p>Speaking of z-indexes, one of the most annoying gotchas with Internet Explorer 6 was that it did not respect z-index when it came to select boxes.</p>
<p>The developers who added select boxes to Internet Explorer (probably around version 3 or 4) were being lazy that day and just shoehorned in the regular select boxes that were used in Windows programs. Apparently they were called <a href="https://blogs.msdn.microsoft.com/ie/2006/01/17/for-the-select-few/" target="_blank" rel="noopener">Windows Shell ListBox and Combobox controls</a>.</p>
<p>So when CSS 2 support got added in and z-index allowed positioned items to overlap and hide other elements with varying degrees of opacity, none of that worked with select boxes. They just always showed through anything you tried to position on top of them. So when you wanted to make a modal box that hid all the content underneath it, you would actually need to manually set “visibility: hidden” on every select box on the page so they could not be interacted with. And hopefully you would remember to restore them later when the user closed the modal.</p>
<p>This bug was eventually fixed in IE 7. However, prior to that, there was one other approach to solving this problem…</p>
<h2 id="7-showModalDialog-in-IE6"><a href="#7-showModalDialog-in-IE6" class="headerlink" title="#7: showModalDialog in IE6"></a>#7: showModalDialog in IE6</h2><p>IE 6 actually had its own dedicated, proprietary method for showing a modal dialog on a page, and it was awesome.</p>
<p>Creating a modal dialog in Firefox was always a bit of a pain. The <a href="https://code.google.com/archive/p/submodal/" target="_blank" rel="noopener">submodal library</a> was the goto solution, but the general technique was to overlay a transparent “mask” div on the page to block the user from interacting with anything on the page, and then position a smaller, centered window with your modal content.</p>
<p>But, if you were working on some corporate Intranet application and didn’t need to worry about supporting non-IE browsers, all you needed was a single method: “<a href="https://docs.microsoft.com/en-us/previous-versions/ms536759%28v%3Dvs.85%29" target="_blank" rel="noopener">showModalDialog</a>“.</p>
<p>It would let you provide a URL to an HTML file that was used to populate the modal and would just work. It showed a transparent overlay over the rest of the page that even supported covering select boxes. There was even a sister method “showModelessDialog” that would remove the toolbar and scrollbar.</p>
<h2 id="6-VBScript"><a href="#6-VBScript" class="headerlink" title="#6: VBScript"></a>#6: VBScript</h2><p>IE 6 actually supported two types of scripting languages in <code>&lt;script&gt;</code> tags: JScript and <a href="https://en.wikipedia.org/wiki/VBScript" target="_blank" rel="noopener">VBScript</a>. JScript was, of course, identical to Javascript but Microsoft couldn’t actually call it that because of trademark issues. VBScript, however, was a completely proprietary language that only worked in Windows and Internet Explorer.</p>
<p>I think the idea was that VBScript would provide a unified scripting experience so that Windows programmers could learn only one scripting language and have it work in Windows applications, Excel macros, and in Web applications. I saw it in the wild once or twice, but for the most part, if you were working on a Web page in the early 2000’s, you were using “JScript”. Every once in awhile though, you’d look in the source of a webpage and see <code>&lt;SCRIPT TYPE=&#39;Text/VBScript&#39;&gt;</code> where some insane person was using it to do roll-overs or a hover menu.</p>
<h2 id="5-DOM-in-old-IE"><a href="#5-DOM-in-old-IE" class="headerlink" title="#5: DOM in old IE"></a>#5: DOM in old IE</h2><p>IE 6, 7 and 8 would store an incredibly frustrating version of the DOM in memory.</p>
<p>If you gave it this XHTML:</p>
<p><code>&lt;h1 class=&quot;header&quot;&gt;Header Here&lt;/h1&gt;</code></p>
<p>and then queried with some Javascript to read that element back out of the DOM, this is what you would get:</p>
<p><code>&lt;H1 class=header&gt;Header Here&lt;/H1&gt;</code></p>
<p>Uppercase element names and no quotes around attribute values…</p>
<p>This made regular expressions far more complicated than they needed to be and generally just felt ugly and depraved. Every time you would use Internet Explorer to return its version of your carefully crafted, validated, strict XHMTL 1.0 code, you suddenly felt like you needed a shower.</p>
<h2 id="4-Firefox-eats-its-own-cursor"><a href="#4-Firefox-eats-its-own-cursor" class="headerlink" title="#4: Firefox eats its own cursor"></a>#4: Firefox eats its own cursor</h2><p>Because I’ve been picking on IE so much, it’s only fair that I include at least one Firefox bug. This one was my favorite.</p>
<p>I couldn’t find the exact bug report to corroborate my memory, but this is how I remember it.</p>
<p>The cursor, also called a “caret”, in Firefox version 1 (or maybe it was 3) would get eaten and you were unable to get it back.</p>
<p>Specifically, if an input had focus and the cursor was visible in it and you set “display: none” on the input, both the cursor and the input would disappear. If you clicked in another input box, you could type but your cursor was permanently invisible. There was no way to get it back without reloading the page.</p>
<p>The fix was to be sure you always called the blur() method on an input before you hid it. Suuuuper annoying.</p>
<h2 id="3-“Operation-Aborted”"><a href="#3-“Operation-Aborted”" class="headerlink" title="#3: “Operation Aborted”"></a>#3: “Operation Aborted”</h2><p>Our final few tidbits are more of Internet Explorer’s lovely foibles.</p>
<p>“Operation Aborted” was one of my least favorite IE bugs. There is a pretty good write-up about this bug <a href="https://weblogs.asp.net/infinitiesloop/Dealing-with-IE-_2600_quot_3B00_Operation-Aborted_2600_quot_3B002E00_-Or_2C00_-how-to-Crash-IE" target="_blank" rel="noopener">here</a>.</p>
<p>The TLDR is that IE 6 &amp; 7 would completely shit the bed and render nothing at all if you tried to append a node to the body of your document. It would show an empty white page with an error alert: “Internet explorer cannot open the internet site {<a href="http://site.com}" target="_blank" rel="noopener">http://site.com}</a>. Operation Aborted.”  That’s pretty bad, right?</p>
<p>Well… technically, you <em>could</em> append to the body as long as you did it from a script tag that was not a direct child of the body (such as a grandchild or a script in the head). And you could always safely append to nodes other than the body.</p>
<p>If you remembered the specifics of this weird bug, you were fine. But it was obscure enough that you would often forget about it, despite the catastrophic consequences of doing so.</p>
<h2 id="2-hasLayout"><a href="#2-hasLayout" class="headerlink" title="#2: hasLayout"></a>#2: hasLayout</h2><p>Internet Explorer 7 and earlier had a proprietary property called “hasLayout”. As the name implies, the property indicates whether an element is able to be rendered on its own, or if it needs to inherit styles from a parent element in order to be rendered.</p>
<p>The property itself is a read-only property, but its importance belied that fact. If you were trying to structure floats on a page and the page itself exhibited strange behavior and generally did not act as it was supposed to, a good first step was looking at the affected elements’ hasLayout values. When you found an element that contained floats but “did not have a layout” then you had found your cluprit.</p>
<p>Since you could not simply define “hasLayout: true”, you needed to employ one of several tactics to modify the element(s) to gain layout. You could set width, height, zoom or several other properties. As soon as you did so, like magic, your layout suddenly began working again.</p>
<p>A decent write-up on hasLayout can be found <a href="https://www.sitepoint.com/internet-explorer-haslayout-property/" target="_blank" rel="noopener">here</a>.</p>
<h2 id="1-Debugging-in-IE"><a href="#1-Debugging-in-IE" class="headerlink" title="#1: Debugging in IE"></a>#1: Debugging in IE</h2><p>Nothing sucked in early versions of Internet Explorer more than the (lack of) debugging tools.</p>
<p>Not to sound like the “I walked 80 miles uphill both ways to school” guy, but Web developers today really cannot appreciate the struggle.</p>
<p>It wasn’t that there was no Web inspector (although there wasn’t).</p>
<p>It wasn’t that there was no debugger (although there wasn’t).</p>
<p>It wasn’t that there was no console (although there wasn’t).</p>
<p>The problem was that when IE hit a Javascript error (because, say, you accidentally included a trailing comma in a JSON structure) all you were given in terms of an error message was some bullshit like this:</p>
<p><code>Line: 5
Char: 33
Error: Unknown Runtime Error</code></p>
<p>There were like 10 different errors that IE might give you and they all meant nothing. So you were left with a goddamn line number and character number to figure out what went wrong.</p>
<p>In the nightmare scenario, you had code that you’d written on a Mac or Linux box that had non-Windows carriage returns in it so everything displayed in Notepad on one line with those stupid little squares where there were supposed to be line breaks. Once you had found the right line somehow, you would click the right arrow key counting as you went: one, two, three, four, five, six, seven. All the way up to thirty-three.</p>
<p>And then you stared at the code for several minutes trying to figure out what it was about that particular character that triggered the error. But, of course, sometimes the actual problem was earlier in the code, so once you realized THAT, you stared at the code for several more minutes, questioning your career choices. What would you be doing right now if you had listened to Greg and gotten into automative HVAC instead?</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/12/12/Useless-Stuff-I-Still-Know/" data-id="ckurjqthi000pdas1pvtq00yj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2017-07-13-dont-let-your-buttons-overlap" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="dan24678/2017/07/13/2017-07-13-dont-let-your-buttons-overlap/" class="article-date">
  <time datetime="2017-07-13T16:13:29.000Z" itemprop="datePublished">2017-07-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="dan24678/2017/07/13/2017-07-13-dont-let-your-buttons-overlap/">Dont Let Your Buttons Overlap</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>While testing some changes I made to a site for work, I caught myself making a somewhat common UI/UX mistake.</p>
<p>Here were the original screens. They show <strong>Step 1</strong> and <strong>Step 2</strong> of a &#8220;Record&#8221; functionality:</p>
<p style="text-align: center;"><br>  <strong>Step 1</strong><br></p>

<p><a href="/dan24678/images/uploads/2017/07/VoiceVibes-2.png"><img class="aligncenter size-medium wp-image-336" alt="VoiceVibes 2" src="/dan24678/images/uploads/2017/07/VoiceVibes-2-300x152.png" width="300" height="152" srcset="/images/uploads/2017/07/VoiceVibes-2-300x152.png 300w, /images/uploads/2017/07/VoiceVibes-2.png 768w" sizes="(max-width: 300px) 100vw, 300px"></a></p>
<p>&nbsp;</p>
<p style="text-align: center;"><br>  <strong>Step 2</strong><br></p>

<p><a href="/dan24678/images/uploads/2017/07/VoiceVibes-3.png"><img class="aligncenter size-medium wp-image-337" alt="VoiceVibes 3" src="/dan24678/images/uploads/2017/07/VoiceVibes-3-300x169.png" width="300" height="169" srcset="/images/uploads/2017/07/VoiceVibes-3-300x169.png 300w, /images/uploads/2017/07/VoiceVibes-3.png 339w" sizes="(max-width: 300px) 100vw, 300px"></a></p>
<p>&nbsp;</p>
<p>Can you spot the problem?</p>
<p>The issue, which is admittedly minor, comes when users double-click the Stop button in Step 1. The first click advances the screen to Step 2 and the second click triggers the Cancel button. Most users know to only use a single click on buttons, but the capacity for users to misuse your UI can never be discounted.</p>
<p>One solution to the problem is to ensure there is an &#8220;Are you sure?&#8221; confirmation on the Cancel button. I already had that in place but didn&#8217;t consider it sufficient.</p>
<p>Another solution is to use Javascript to detect and suppress the second &#8220;half&#8221; of the double-click. But&#8230; ain&#8217;t nobody got time for that.</p>
<p>In the end, I tweaked the layout on the <strong>Step 1</strong> design to push the button further down so it no longer overlaps the other button in terms of screen position:</p>
<p><a href="/dan24678/images/uploads/2017/07/VoiceVibes.png"><img class="aligncenter size-medium wp-image-338" alt="VoiceVibes" src="/dan24678/images/uploads/2017/07/VoiceVibes-300x193.png" width="300" height="193" srcset="/images/uploads/2017/07/VoiceVibes-300x193.png 300w, /images/uploads/2017/07/VoiceVibes.png 379w" sizes="(max-width: 300px) 100vw, 300px"></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/13/2017-07-13-dont-let-your-buttons-overlap/" data-id="ckurjqthh000odas1yae734nh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-05-07-campaign-error-logging-with-new-relic-insights" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="dan24678/2016/05/07/2016-05-07-campaign-error-logging-with-new-relic-insights/" class="article-date">
  <time datetime="2016-05-07T08:27:45.000Z" itemprop="datePublished">2016-05-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="dan24678/2016/05/07/2016-05-07-campaign-error-logging-with-new-relic-insights/">Campaign Error Logging with New Relic Insights</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Several weeks ago, a project which I&#8217;d worked on for the better part of two months finally went live across all LeadiD customer campaigns. In many ways, I am prouder of this project than I am of anything else I&#8217;ve done in the ten years or so that I&#8217;ve been doing web development &#8212; in large part because the finished product is just so damn cool.</p>
<p>Because I can&#8217;t help myself, I&#8217;m going to jump right to the pretty pictures. By leveraging the <a href="http://newrelic.com/insights" target="_blank" rel="noopener">Insights reporting backend</a> provided by New Relic, LeadiD now has access to a full dashboard that tracks all the errors and debug data associated with our customer&#8217;s campaign scripts:</p>
<p><a href="/dan24678/images/uploads/2016/05/Insights__Campaign_JS.png"><img class="aligncenter size-large wp-image-304" alt="Insights__Campaign_JS" src="/dan24678/images/uploads/2016/05/Insights__Campaign_JS-1024x537.png" width="640" height="335" srcset="/images/uploads/2016/05/Insights__Campaign_JS-1024x537.png 1024w, /images/uploads/2016/05/Insights__Campaign_JS-300x157.png 300w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<h2 id="Why-is-this-Cool"><a href="#Why-is-this-Cool" class="headerlink" title="Why is this Cool?"></a>Why is this Cool?</h2><p>Thousands of businesses use New Relic or their competitors to monitor their web sites and track errors. Why is what LeadiD did so interesting?</p>
<p>For the answer to this, you need to look at what it is we are actually monitoring. In order for LeadiD&#8217;s core services to operate, our customers must include the LeadiD campaign javascript on their site. Simply by including this script on the footer of their site, our customers gain unique insight and visibility into the actions and motivations of their site visitors. First and foremost, our javascript was written with two main areas of focus: performance and stability. Nonetheless, millions of individual consumers execute our javascript each day and some of those visits result in javascript errors. It is these errors which we are now monitoring.</p>
<p>Specifically, whenever an individual consumer triggers an error in our campaign javascript on any of the 20,000+ web domains who have partnered with LeadiD, we get a record of that error in our New Relic Insights dashboard, where the data is tracked and graphed so we can immediately see the impact as we push out new features or fix pre-existing bugs.</p>
<h2 id="How-Does-it-Work"><a href="#How-Does-it-Work" class="headerlink" title="How Does it Work?"></a>How Does it Work?</h2><p><a href="/dan24678/images/uploads/2016/05/campaign_js_blog.png"><img class="alignleft size-medium wp-image-318" alt="campaign_js_blog" src="/dan24678/images/uploads/2016/05/campaign_js_blog-300x274.png" width="300" height="274" srcset="/images/uploads/2016/05/campaign_js_blog-300x274.png 300w, /images/uploads/2016/05/campaign_js_blog.png 520w" sizes="(max-width: 300px) 100vw, 300px"></a>As shown in the diagram, a customer site AwesomeWalruses.com has implemented the LeadiD campaign javascript. Every time a visitor encounters an error in our script (or if debug logging, which I&#8217;ll discuss later, is enabled) a record is sent back to a logging microservice running on our domain. Typically, this request is sent as an asynchronous XmlHttpRequest from the client browser and includes all the available details about the error. From there, the microservice pushes the data into New Relic Insights.</p>
<p>One key item to note is that regular javascript errors on AwesomeWalruses.com are not reported back to our logging system. It is only errors in <span style="text-decoration: underline;"><strong>our</strong></span> campaign javascript which are being tracked.</p>
<p>To get this level of granularity, much of our campaign javascript is wrapped in try/catch blocks, instead of using the alternative method of binding to the global window.onerror handler. While the latter solution can likely provide a more sure method of capturing all errors, it is more risky and complicated when you consider the need to filter out errors from the parent site. Try/catch blocks, however, carry with them their own <a href="http://ryanmorr.com/reinventing-the-try-catch-block/" target="_blank" rel="noopener">performance considerations</a>.</p>
<p>One crucial feature which our campaign javascript now supports is a verbose debug logging setting. If this is enabled for a specific customer campaign, LeadiD receives javascript performance data from all visitors to a site, even if an error is never triggered. Because this is such a huge amount of data, the messages need to be batched together when they are sent to us and then unbatched in the microservice so each item is saved to New Relic separately. It&#8217;s interesting to note that enabling debug logging <span style="text-decoration: underline;"><strong>for a single customer</strong></span> triples our daily Insights data usage with New Relic (visible in the &#8220;Volume of Log Requests&#8221; graph above).</p>
<h2 id="Preliminary-Project-Design-and-Initial-Prototype"><a href="#Preliminary-Project-Design-and-Initial-Prototype" class="headerlink" title="Preliminary Project Design and Initial Prototype"></a>Preliminary Project Design and Initial Prototype</h2><p>When the project was first conceived, the specific backend where the logging data would be stored was an open question.</p>
<p>LeadiD was already using New Relic for server monitoring and <a href="https://raygun.com/" target="_blank" rel="noopener">RayGun</a> for application error logging. As a result, either service had the potential to be a good fit for this project. Additionally, I had previous experience with the open source project <a href="https://getsentry.com/welcome/" target="_blank" rel="noopener">Sentry</a> and, as a free software alternative to New Relic and RayGun, there were definite cost advantages to going with Sentry. As an additional free software alternative, we considered the <a href="https://www.elastic.co/products" target="_blank" rel="noopener">ELK stack</a> (ELK stands for Elastic Search, Logstash and Kibana).</p>
<p>With assistance from our first-rate Dev Ops team, I prototyped a backend that injected data into all the services except Elk, which we never tested due to the effort. (The prototype microservice was thankfully thrown away and reimplemented by Senior Engineer Ian Carpenter, which is what you hope for when you build a prototype). Next, we drew up a comparison table showing each choice&#8217;s strengths:</p>
<p style="text-align: center;"><br>  <a href="/images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence.png"><img class="aligncenter size-medium wp-image-308" alt="Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence" src="/dan24678/images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence-300x232.png" width="300" height="232" srcset="/images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence-300x232.png 300w, /images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence-1024x795.png 1024w, /images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence.png 1110w" sizes="(max-width: 300px) 100vw, 300px"></a><br></p>

<p>To cut the chase, New Relic Insights was very compelling for 2 reasons:</p>
<ul>
<li>The ability to run SQL-like queries against the data and graph the results with very little work</li>
<li>As a SaaS-based solution, we save large amounts of time versus writing and maintaining our own solution</li>
</ul>
<p>One of the interesting realizations we had when comparing the chart above with our &#8220;technical requirements&#8221; was that error data and logging data are fundamentally two different things. Three of the four alternatives are more directly geared toward error data than storing normal application logging data, but New Relic Insights (which is essentially a NoSQL database masquerading as a relational one) proved itself able to be molded to fit both error messages <strong>and</strong> logging data. A few of the negatives to New Relic noted in the table ended up not mattering after all:</p>
<ul>
<li>The 256-character limit on tag length is mitigated by simply spreading your data across multiple fields</li>
<li>While we relinquish some control by having our error and logging data stored in New Relic&#8217;s system, the <a href="https://docs.newrelic.com/docs/insights/new-relic-insights/adding-querying-data/querying-your-data-remotely" target="_blank" rel="noopener">Insights API</a> allows integrations with this data. (I even wrote a script called <a href="https://github.com/DrLongGhost/insights2csv" target="_blank" rel="noopener">insights2csv</a> to easily pull down our data so we can import it into PostgreSQL and elsewhere)</li>
</ul>
<h2 id="The-Results"><a href="#The-Results" class="headerlink" title="The Results"></a>The Results</h2><p>LeadiD now has a system that allows us to monitor in real-time the impact of our client-side releases. This enables us to monitor new versions of our javascript as it goes live across all our customer sites and compare the volume of errors thrown by the new version against the historical norm from prior versions. If we begin seeing more errors than expected for the new version, we can immediately roll back the deployment and begin digging into the logging data itself to figure out what went wrong.</p>
<p>To this end, we can easily pull the data down from New Relic Insights to feed it into other databases to enable more advanced queries. This also facilitates resource sharing with our Data Science department, who are now able to use the data on which consumers encountered errors to exclude that problematic data from the datasets they use to train machine learning and develop scoring models.</p>
<p>Several specific examples of how LeadiD Engineering are using the Insights data are visible in the dashboard graphs above. We are now able to identify specific customer sites which are sending us high volumes of error data. It is far better for a company to proactively identify issues and reach out to its customers than it is for the company to fix the problem only after customers have noticed and complained. LeadiD is now in a position to notice any such errors before our customers do and before the errors have a chance to have a major negative impact on our products.</p>
<p>By partnering with client sites to run trials of the verbose debug logging, we have already identified several potential improvements to our libraries. Being able to follow the breadcrumbs left by the debug logging is an essential tool in keeping our scripts up-to-date with the latest browser APIs and in ensuring smooth co-existence with the various javascript frameworks in use today. Without this logging ability, it is an order of magnitude more difficult to even recognize that something is wrong, let alone figure out where in the code the problem may reside.</p>
<p>All in all, the finished Campaign JS Logging system has met or exceeded all the project goals. I had a lot of fun developing the finished solution and it continues to provide value to LeadiD and our customers on a daily basis.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/07/2016-05-07-campaign-error-logging-with-new-relic-insights/" data-id="ckurjqthg000ndas1nj2duzmd" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2016-04-17-ms-7352-manual" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="dan24678/2016/04/17/2016-04-17-ms-7352-manual/" class="article-date">
  <time datetime="2016-04-17T15:34:32.000Z" itemprop="datePublished">2016-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="dan24678/2016/04/17/2016-04-17-ms-7352-manual/">MS-7352 Manual</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="/dan24678/images/uploads/2016/04/51DCc9FrsJL.jpg"><img class="aligncenter size-full wp-image-298" alt="51DCc9FrsJL" src="/dan24678/images/uploads/2016/04/51DCc9FrsJL.jpg" width="300" height="300" srcset="/images/uploads/2016/04/51DCc9FrsJL.jpg 300w, /images/uploads/2016/04/51DCc9FrsJL-150x150.jpg 150w" sizes="(max-width: 300px) 100vw, 300px"></a></p>
<p>I just finished one of the trickiest computer builds I&#8217;ve ever done. The main annoyance was the motherboard I bought doesn&#8217;t have a manual (since it was OEM no manual exists). I wanted to document everything I&#8217;ve learned about this motherboard for posterity.</p>
<p>First some info on the motherboard so this post shows up in search engines: <strong>MSI HP Intel Q33 Socket 775 mATX Motherboard manual</strong>. Also called: <strong>MSI MS-7352 manual and installation</strong>. The motherboard itself was apparently used exclusively in Hewlett-Packard desktops, which explains why no manual exists anywhere online.</p>
<p>I bought the motherboard as a replacement for the one in my PC which died. Since it was only $40 I thought it was a deal (and it was) but it is an extremely tempermental mobo and was very difficult to get installed and working. Thankfully there were some very helpful resources online so I wanted to make this blog post to gather all the relevant info on this mobo in one place.</p>
<p>The initial problems I had installing this were some combination of the following:</p>
<ul>
<li>It won&#8217;t boot without RAM and a CPU. When I say &#8220;it won&#8217;t boot&#8221; here and below, I mean it shuts off immediately without going into BIOS or giving any indication that isn&#8217;t broken. It doesn&#8217;t show anything on the monitor and it doesn&#8217;t send power to your USB devices (although the fans will briefly spin).</li>
<li>It won&#8217;t boot if the RAM is in slot 4 instead of slot 1. The slots are numbered on the mobo so make sure you&#8217;re plugged into slot 1 with a single stick first.</li>
<li>It won&#8217;t boot if the case power switch is hooked up wrong which is easy <span style="text-decoration: underline;"><strong>since it&#8217;s mislabeled</strong></span> on the board itself</li>
<li>It won&#8217;t boot if the CPU fan isn&#8217;t plugged in</li>
<li>It won&#8217;t boot if the case fan isn&#8217;t plugged in</li>
<li>It won&#8217;t boot if the CPU power connector on the mobo isn&#8217;t connected</li>
<li>(Potentially) it won&#8217;t boot if the CPU fan/heatsink isn&#8217;t secured properly or isn&#8217;t compatible</li>
<li>There&#8217;s no feedback when it won&#8217;t boot to tell you what&#8217;s wrong, except maybe a few beeps on the speaker, but there&#8217;s no manual to tell what the beeps mean and the 2-wire connector on the mobo was incompatible with my case&#8217;s 4-pin speaker anyway. So I had nothing to go on.</li>
</ul>
<h2 id="Case-Power-Switch-Hook-Up"><a href="#Case-Power-Switch-Hook-Up" class="headerlink" title="Case Power Switch Hook-Up"></a>Case Power Switch Hook-Up</h2><p>I&#8217;m pretty sure the labels on the mobo for where to put the various switches are wrong. I used this config instead and everything seems to work great. Credit due to <a href="http://www.mxdatarecovery.net/msi-ms-7525-bostongl6-motherboard-power-switch-jumper-settings.html" target="_blank" rel="noopener">http://www.mxdatarecovery.net/msi-ms-7525-bostongl6-motherboard-power-switch-jumper-settings.html</a></p>
<p><a href="/dan24678/images/uploads/2016/04/ms-7525-msi-motherboard-front-panel-power-switch-hd-led-connectors.gif"><img class="aligncenter size-full wp-image-296" alt="ms-7525-msi-motherboard-front-panel-power-switch-hd-led-connectors" src="/dan24678/images/uploads/2016/04/ms-7525-msi-motherboard-front-panel-power-switch-hd-led-connectors.gif" width="315" height="354"></a></p>
<h2 id="CPU-Issues"><a href="#CPU-Issues" class="headerlink" title="CPU Issues"></a>CPU Issues</h2><p>I tried to use an Intel heatsink that came with my Core 2 Duo but the snap-based connectors didn&#8217;t fit the holes in the mobo. I tried holding it in place just to get it to boot but that didn&#8217;t work so I think it may have been incompatible electronically with the hardware check (although the fan did power on). Anyway, <a href="http://www.amazon.com/MASSCOOL-90mm-Bearing-Cooler-8WT15-38/dp/B000VSHT3C?ie=UTF8&amp;psc=1&amp;redirect=true&amp;ref_=oh_aui_detailpage_o02_s00" target="_blank" rel="noopener">this was the heatsink I eventually bought</a> that worked perfectly. It comes with its own thermal paste and also a backplate that its supposed to screw into but I ended up not needing the backplate since the threads on the fan screws matched the threaded holes in the mobo. <span style="text-decoration: underline;"><strong>Don&#8217;t overtighten it though</strong></span>.</p>
<h2 id="Fan-Issues"><a href="#Fan-Issues" class="headerlink" title="Fan Issues"></a>Fan Issues</h2><p>As mentioned above, CPU fan must be compatible and both the fan power and the CPU power plug on the mobo must all be plugged in.</p>
<p>Additionally, the <span style="text-decoration: underline;"><strong>case fan</strong></span> must be plugged in and working or the system will refuse to boot. This was a problem since my fan needs a 3-pin connector and the mobo only provides 2-pin. I bought <a href="http://www.amazon.com/Molex-Computer-Connector-Y-Splitter-Adapter/dp/B00DU8ZZ0O?ie=UTF8&amp;psc=1&amp;redirect=true&amp;ref_=oh_aui_detailpage_o02_s01" target="_blank" rel="noopener">this adapter</a> which lets me send power to my system fan via my power supply. This bypasses the mobo connector, however, so the mobo still thinks there&#8217;s no fan and shuts itself off with a broken fan warning after briefly showing the BIOS. There may be a better adapter than the one I used which lets you actually use the 2-pin conector on the mobo.</p>
<p>What I ended up doing, however, was disabling the fan hardware check in the BIOS, but it&#8217;s tricky to do. As the computer boots you need to continually hit <strong>Control-F10</strong> until you get into the BIOS screen where you can access the Hardware Monitor / Fan Check options and disable all of them.</p>
<p>Credit (and full instructions on disabling the Hardware Monitoring) are at <a href="http://retrohelix.com/2012/09/how-to-fix-the-f2-system-fan-error-on-some-hp-computers/" target="_blank" rel="noopener">http://retrohelix.com/2012/09/how-to-fix-the-f2-system-fan-error-on-some-hp-computers/</a></p>
<h2 id="Success"><a href="#Success" class="headerlink" title="Success!"></a>Success!</h2><p>Once I addressed all the above issues over the course of about 4 hours, I finally got the motherboard to boot into my preexisting install of Ubuntu and everything worked great. I was happy that Ubuntu had no problem with me switching to a completely different make and model motherboard and that the HP MSI MS-7352 eventually worked as expected. The only curve balls were the need to buy a new heat sink, that fan connector converter and the 4 goddamn hours it took me to figure all this shit out.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/17/2016-04-17-ms-7352-manual/" data-id="ckurjqthf000mdas15ahfwlhn" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2015-11-21-connection-management" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="dan24678/2015/11/21/2015-11-21-connection-management/" class="article-date">
  <time datetime="2015-11-21T18:02:35.000Z" itemprop="datePublished">2015-11-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="dan24678/2015/11/21/2015-11-21-connection-management/">Connection Management</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In my experience, an often-overlooked principle of endpoint design is the idea of minimizing connection use.  Any time you connect to an external resource, you should try to avoid connecting to it as much as possible and, if you really do need to connect to it, connect for as short a period of time as possible. And when you do connect, don&#8217;t have anything else connected at the same time.</p>
<h2 id="Avoid-Connecting-to-External-Resources"><a href="#Avoid-Connecting-to-External-Resources" class="headerlink" title="Avoid Connecting to External Resources"></a><span style="font-size: large;">Avoid Connecting to External Resources</span></h2><p>If you have a system that rejects requests because they&#8217;re invalid, request validation should happen before you connect to the DB so that invalid requests never even trigger a DB connection.</p>
<p>Similarly, don&#8217;t open a DB connection on ALL requests just because some percentage of requests need to execute a particular operation. Wait until you actually need to perform the operation to open the connection.</p>
<p>For other use cases, can you cache something locally and periodically invalidate the cache to avoid touching the DB on every request? In other words, does your application really need real-time data or is some level of delay acceptable so you can implement caching?</p>
<h2 id="Connect-as-Briefly-as-Possible"><a href="#Connect-as-Briefly-as-Possible" class="headerlink" title="Connect as Briefly as Possible"></a><span style="font-size: large;">Connect as Briefly as Possible</span></h2><p>An anti-pattern in PHP is to open a DB connection immediately then let PHP close it for you when the page load is finished. If you do this, you are keeping the DB connection open for longer than you are actually using it, meaning you may need more total connections to support your app.</p>
<p>A best practice is to wait until you need a connection, then open it, run your queries and immediately close the connection before proceeding to actually use the data you fetched.</p>
<p>Another, more debatable piece of advice is to do data transformations and joins in your application code instead of in your DB queries. Again, this will make things easier on your database by distributing work to your (cheaper) application servers. But the cost in complexity and some level of waste may make this a non-starter.</p>
<h2 id="Don-8217-t-Overlap-TCP-Connections"><a href="#Don-8217-t-Overlap-TCP-Connections" class="headerlink" title="Don&#8217;t Overlap TCP Connections"></a><span style="font-size: large;">Don&#8217;t Overlap TCP Connections</span></h2><p>Let&#8217;s say you have 1000 available MySQL connections and 50 available memcached connections and you keep them both open at the same time. You now have a situation where a slow-running MySQL query results in memcached connections being held open and your system goes down once your 50 memcached connections are swamped (even though you potentially had sufficient MySQL connections to actually handle the slow query, had the connections not overlapped).</p>
<p>This also holds true for other types of connections, such as Curl requests to external APIs or messaging systems like RabbitMQ or Kafka. I once saw slow-running requests to Facebook&#8217;s API cause my company&#8217;s memcached connection pool to be exhausted because the two were allowed to overlap.</p>
<h2 id="Final-Thoughts"><a href="#Final-Thoughts" class="headerlink" title="Final Thoughts"></a><span style="font-size: large;">Final Thoughts</span></h2><p>Connection pooling solutions can help reduce the latency of opening new connections but this doesn&#8217;t alter the inherent danger of depleting the maximum number of allowable connections within the pool, so much of the above still applies.</p>
<p>One thing that may turn the advice above on its head, however, is the move to multi-threading, asynchronous requests and the concepts of Actors and Futures in newer languages like Scala.  In these environments, I can envision scenarios where you may want to preemptively fetch some data on a separate thread before you&#8217;re sure you need it because the cost in connection usage and the waste of sometimes getting data you don&#8217;t need is a fair price to pay for a modest decrease in average response time.</p>
<p>The ability to do two things at once turns all the advice above on its head.  <span style="line-height: 1.5em;">The times they are a&#8217;changing.</span></p>
<p>&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-</p>
<p>Comment on reddit <a href="https://www.reddit.com/r/programming/comments/3tpsuy/connection_management/" target="_blank" rel="noopener">here</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/11/21/2015-11-21-connection-management/" data-id="ckurjqth8000jdas17a2d4mrh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-/food-food/" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="dan24678/2015/07/15/food-food/" class="article-date">
  <time datetime="2015-07-16T00:51:12.000Z" itemprop="datePublished">2015-07-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="dan24678/categories/Uncategorized/">Uncategorized</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="dan24678/2015/07/15/food-food/">food != food</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I ran into this issue at work several weeks back and figured I&#8217;d drop a quick blog post about it, as it&#8217;s kinda nifty.</p>
<p>Some string matching code in our backend was reporting mismatches on identical text. I found an example of the text and played around with it in console and was able to isolate it to the following:</p>
<p><a href="/dan24678/images/uploads/2015/07/Add_New_Post_‹_Ruminations_from_the_Long_Doctor_—_WordPress.png"><img class="aligncenter size-large wp-image-260" alt="Add_New_Post_‹_Ruminations_from_the_Long_Doctor_—_WordPress" src="/dan24678/images/uploads/2015/07/Add_New_Post_‹_Ruminations_from_the_Long_Doctor_—_WordPress-1024x233.png" width="640" height="145" srcset="/images/uploads/2015/07/Add_New_Post_‹_Ruminations_from_the_Long_Doctor_—_WordPress-1024x233.png 1024w, /images/uploads/2015/07/Add_New_Post_‹_Ruminations_from_the_Long_Doctor_—_WordPress-300x68.png 300w, /images/uploads/2015/07/Add_New_Post_‹_Ruminations_from_the_Long_Doctor_—_WordPress.png 1140w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<p>This was a bit of a headscratcher. If you don&#8217;t believe me, copy and paste this code into console and try it yourself:</p>
<p><code>&#39;food​&#39; == &#39;food&#39;</code></p>
<p>So&#8230; can you figure out what&#8217;s going on here?</p>
<p>Go ahead. I&#8217;ll wait&#8230;</p>
<p>It took me a hot minute to suss it out, but for me, the thing that clued me in was using the arrow keys to step through the string. You&#8217;ll notice that it takes an extra keypress to navigate between the letter d in the first &#8220;food&#8221; and the closing apostrophe.</p>
<p>It turns out there was a unicode character there called the <a href="http://www.fileformat.info/info/unicode/char/200B/index.htm" target="_blank" rel="noopener">zero width space</a>. This character exists on the page and will come into play when doing string comparisons, but is effectively invisible.</p>
<p>This got me thinking&#8230; I know there are quite a few characters that appear identical but have different code points. So there might be an ê with a little hat on it in one language that appears identical to the ê in a different language, but they are technically different unicode characters and thus not at all the same.</p>
<p>So, if we can have 2 words that look the same but are different, can we have 2 words that look different but are the same?</p>
<p>This was the best I could come up with:</p>
<p><a href="/dan24678/images/uploads/2015/07/Unicode_Character__RIGHT-TO-LEFT_OVERRIDE___U_202E_.png"><img class="aligncenter size-large wp-image-266" alt="Unicode_Character__RIGHT-TO-LEFT_OVERRIDE___U_202E_" src="/dan24678/images/uploads/2015/07/Unicode_Character__RIGHT-TO-LEFT_OVERRIDE___U_202E_-1024x224.png" width="640" height="140" srcset="/images/uploads/2015/07/Unicode_Character__RIGHT-TO-LEFT_OVERRIDE___U_202E_-1024x224.png 1024w, /images/uploads/2015/07/Unicode_Character__RIGHT-TO-LEFT_OVERRIDE___U_202E_-300x65.png 300w, /images/uploads/2015/07/Unicode_Character__RIGHT-TO-LEFT_OVERRIDE___U_202E_.png 1176w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<p>There is a unicode character called the <a href="http://www.fileformat.info/info/unicode/char/202e/index.htm" target="_blank" rel="noopener">right-to-left override</a> which basically opens a portal to Hell by turning all the text appearing after it backwards. Go ahead and paste this into your console and play around with it a little. But make sure to step away before you shoot yourself:</p>
<p><code>&#39;‮food‮&#39; == &#39;‮food‮&#39;</code></p>
<p>It turns out this character has some interesting security implications, as it can be used to manipulate URLs to make certain phishing attacks easier.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/07/15/food-food/" data-id="ckurjqth7000idas1uhju8c6z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2014-12-27-shortening-the-feedback-path4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="dan24678/2014/12/27/2014-12-27-shortening-the-feedback-path4/" class="article-date">
  <time datetime="2014-12-28T01:38:13.000Z" itemprop="datePublished">2014-12-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="dan24678/2014/12/27/2014-12-27-shortening-the-feedback-path4/">Shortening the Feedback Path</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>A subconscious best practice I&#8217;ve noticed in the world of web development is the drive to shorten the feedback path. This is best illustrated by an example.</p>
<p>Let&#8217;s pretend that a web form has various collapsible sections. The top section is expanded by default, pushing the bottom (collapsed) section down below the fold. Once the bottom section is expanded, there is a link that when clicked opens up a modal date-picker.</p>
<p>If you don&#8217;t optimize things, your workflow may look something like this:</p>
<ol>
<li>Make some changes to the date picker javascript</li>
<li>Refresh the page</li>
<li>Click to collapse the top section, bringing the bottom section into view</li>
<li>Click to expand the bottom section</li>
<li>Click the link to show the date picker</li>
<li>Test your change</li>
</ol>
<p>Obviously, this is a somewhat sub-optimal workflow that can grow quite painful quickly. Luckily, there are a number of different approaches to streamlining things a bit.</p>
<h2 id="The-Best-Best-Practice-Tests"><a href="#The-Best-Best-Practice-Tests" class="headerlink" title="The Best Best Practice: Tests"></a>The Best Best Practice: Tests</h2><p>The ideal situation for developing your date picker is to do it in a test-driven manner.</p>
<p>If you can make the case that tests are worth doing (and they usually are), it&#8217;s definitely the way to go.  This is especially true if you are writing a library or a widget that is intended to be used in numerous different places. If our fictitious date picker is something we are writing from scratch, even if it is only likely to be used on this one page, the best way to go about it is to treat it as a widget with its own test suite and develop it in isolation from the rest of the page.</p>
<p>Tests provide immediate feedback. When you make a change to your date picker, you can have your tests auto-run in a separate window and get instant gratification. This completely side-steps the painful process of testing a widget that is hidden deep in the interactive guts of a complicated form.</p>
<p>The idea of doing test-driven development in javascript only became a reality fairly recently. There are many different combinations of javascript libraries that can be used to facilitate this, but the ones I find myself using most frequently are:</p>
<ul>
<li><a href="http://jasmine.github.io/" target="_blank">Jasmine</a>: Provides a BDD-based testing framework</li>
<li><a href="http://phantomjs.org/" target="_blank">PhantomJS</a>: Enables headless browser testing. You can run meaningful tests against a WebKit-based browser solely from the commandline</li>
<li><a href="http://gruntjs.com/" target="_blank">Grunt</a>: A task-runner to tie all the pieces together</li>
</ul>
<h2 id="Sometimes-You-Can-8217-t-Do-What-You-Should"><a href="#Sometimes-You-Can-8217-t-Do-What-You-Should" class="headerlink" title="Sometimes You Can&#8217;t Do What You Should"></a>Sometimes You Can&#8217;t Do What You Should</h2><p>I wouldn&#8217;t quite call unit tests for javascript a luxury for the same reason a seatbelt isn&#8217;t a luxury. Actually, a better analogy is probably an air bag in the early-90s.  All the nice cars had them and everyone knew air bags are the way to go and something you should have in your car.  But you spent all summer working at Dairy Queen for $4.65 an hour and only saved up enough money to buy an &#8217;82 Buick Regal with white leather seats, an FM radio and no air bags.</p>
<p>And so, sometimes we find ourselves debugging a date picker without recourse to tests.</p>
<p>In order to avoid the painful multi-step process of refresh, click, scroll, then click again to see the results of our change, there are a couple things we can do.</p>
<h2 id="Automate-the-Clicking"><a href="#Automate-the-Clicking" class="headerlink" title="Automate the Clicking"></a>Automate the Clicking</h2><p>Rather than forcing yourself to click on the page elements each time, figure out what the equivalent jQuery code is to trigger these elements and then automate it.</p>
<p>The code might look something like this:</p>
<pre>$('.collapsible-header:first').click(); // hide the top section</pre>

<pre>$('.collapsible-header:nth-child(3)').click(); // show the bottom section</pre>

<pre>$('#dingleberry-form a.picker-trigger').click(); // show the date picker</pre>

<p>There&#8217;s a couple ways you can trigger this code. The easiest is to simply type it into the javascript console as a 1-liner and trigger it manually. You can then use &#8220;arrow-up&#8221; to get to it after each page refresh. This isn&#8217;t a bad way to go, but we can do better.</p>
<p>Another option is to surround it with a $(function() { }) so it will be called onload and put it into our page&#8217;s JS code somewhere. This completely automates it with only a single drawback: you may forget to remove it later. Add a &#8220;TODO: Remove this shit&#8221; comment above the code to help draw attention to it later.</p>
<p>Or even better, install <a href="https://chrome.google.com/webstore/detail/dotjs/dlnccnmhpmdidoiecanghgienhoglnim?hl=en" target="_blank">dotjs</a> or a similar extension so you can execute arbitrary javascript on your pages without actually putting it in your versioned, &#8220;production&#8221; files. But at that point, maybe you should just write a test.</p>
<h2 id="Keep-Shit-Modular"><a href="#Keep-Shit-Modular" class="headerlink" title="Keep Shit Modular"></a>Keep Shit Modular</h2><p>Another way to handle hiding the section you don&#8217;t want to see is to simply delete it off the page temporarily. If you&#8217;ve kept your code modular and concise then each page section will be its own template that you can suppress by commenting out a single line.</p>
<p>This technique proved invaluable to a page redesign I&#8217;m currently working on. There are 3 sections to the page and I placed each section in its own template. When I need to make a change to one of these sections, I can easily comment out the 2 lines in the parent template that include the sections I don&#8217;t want to see.</p>
<p>This technique really makes me appreciate jQuery&#8217;s complacent attitude when something doesn&#8217;t exist &#8212; e.g., <em>$(&#8216;.jacobs-ladder&#8217;).css(&#8216;height&#8217;, &#8216;10000px&#8217;)</em> won&#8217;t throw any errors if there are no such elements on the page.</p>
<h2 id="Auto-Refresh-the-Page"><a href="#Auto-Refresh-the-Page" class="headerlink" title="Auto-Refresh the Page"></a>Auto-Refresh the Page</h2><p>Manually clicking the refresh button on the browser is for suckers. There are a couple good options for automating this:</p>
<ul>
<li><a href="https://www.npmjs.com/package/grunt-contrib-watch" target="_blank" rel="noopener">grunt-contrib-watch</a>: A Grunt plugin for directory watching. A great option even for non-javascript projects</li>
<li><a href="http://tin.cr/" target="_blank" rel="noopener">Tincr</a>: A chrome extension for auto-updating JS/CSS that&#8217;s been changed without needing a full-page reload</li>
<li><a href="https://github.com/emcrisostomo/fswatch" target="_blank" rel="noopener">fswatch</a>: A general purpose solution that lets you trigger directory monitoring on-the-fly.</li>
<li><a href="https://github.com/DrLongGhost/reload" target="_blank" rel="noopener">reload.sh</a>: A shell script written by yours truly. It is basically a wrapper around fswatch that lets you specify defaults and has added support for triggering browser reloads on OS-X.</li>
</ul>
<p>One interesting aside is I&#8217;ve noticed that none of these solutions (even mine) really give me exactly what I want. Sometimes the detection of when a file has changed is slow and I&#8217;m left staring at the browser waiting on it to pick up the change, until I get frustrated and click it myself (thus defeating the purpose of the directory monitoring)*. Other times I will save a file and I <em>won&#8217;t</em> want it to refresh the browser. Or I&#8217;ll save 5 files and only want a refresh on the last save. Still, it&#8217;s worth it for those times when I make a big change then switch over to my browser and the refreshed code is there waiting for me.</p>
<p>*One notable instance of when tests take a long time to run in response to a change occurs when VMs are in the mix. I&#8217;ve noticed that if you are monitoring a very large directory on a VM which is using a shared file-system such as NFS, changes can take tens of seconds to be detected. A great workaround is to monitor the large directory natively (outside of the VM) where directory monitoring performs well. When the change is detected, jiggle a file in a small, otherwise empty directory and then have the VM monitor <strong>that</strong>. This generally performs much better.</p>
<h2 id="Case-Study-Writing-reload-sh"><a href="#Case-Study-Writing-reload-sh" class="headerlink" title="Case Study: Writing reload.sh"></a>Case Study: Writing reload.sh</h2><p>I wrote <a href="https://github.com/DrLongGhost/reload" target="_blank" rel="noopener">reload.sh</a> because I wanted to be able to set up browser reloading on-the-fly without needing to configure a Gruntfile. Also, it was a great excuse to write something in bash. My process for writing the script is itself illustrative of several steps I took to shorten the path to feedback.</p>
<p>While it would have been ideal to write tests for reload.sh then use it to trigger tests against a separate instance of itself, this wasn&#8217;t to be. This is unfortunate as it would&#8217;ve been super-meta to be able to use this script on itself. Instead, I opted to simply have it execute an &#8220;echo foo&#8221; when a file changed so I could see it was working. This initially resulted in the following workflow during development:</p>
<ol>
<li>Make a change to the script</li>
<li>Click into a console window and run reload.sh (ask it to monitor /tmp/ and &#8220;echo foo&#8221; when it detects a file change)</li>
<li>Click into a second console window and &#8220;touch /tmp/myself&#8221;. Watch for the output on console 1.</li>
<li>Click back into the original console window and hit control-c to exit the script so I&#8217;m ready for my next change</li>
</ol>
<p>This proved cumbersome but I quickly hit on a way to remove steps 3 &amp; 4. I wrote a separate shell script to touch myself and then kill myself so I wouldn&#8217;t have to do it by hand:</p>
<pre>touch /tmp/myself ; sleep 2; pkill -f reload.sh</pre>

<p>The only downside to this workflow was that because reload.sh ran in a loop, I had to invoke my second script from within my first script (which meant I had one line in my script that I&#8217;d have to remove or comment out prior to committing it back into version control).</p>
<h3 id="In-Conclusion"><a href="#In-Conclusion" class="headerlink" title="In Conclusion"></a>In Conclusion</h3><p>Shortening the feedback path may not always save you time, but it <strong>will</strong> save your sanity. Being able to immediately see the results of your work creates a much more pleasant experience. Use automation and whatever hacks you need to keep yourself from needing to click on anything. You&#8217;ll be better off for it.</p>
<p>&nbsp;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/12/27/2014-12-27-shortening-the-feedback-path4/" data-id="ckurjqth6000hdas1x8j1in8c" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2014-06-04-conways-game-of-life" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="dan24678/2014/06/04/2014-06-04-conways-game-of-life/" class="article-date">
  <time datetime="2014-06-05T00:45:28.000Z" itemprop="datePublished">2014-06-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="dan24678/2014/06/04/2014-06-04-conways-game-of-life/">Conways Game of Life</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Several months ago I was interviewing with various companies, primarily for senior web developer roles. In total I probably spoke with just under a dozen companies. Some had phone screens and some had in-person interviews. Some had written tests and some used white boards. My favorite of all the different interview approaches were the companies who asked me to build something. And of the companies who asked me to build something, my favorite was being asked to build Conway&#8217;s Game of Life (<a href="http://en.wikipedia.org/wiki/Conway's_Game_of_Life" target="_blank">wikipedia link</a>).</p>
<p><a href="/dan24678/images/uploads/2014/06/Conway_s_Life.png"><img class="aligncenter size-medium wp-image-226" alt="Conway_s_Life" src="/dan24678/images/uploads/2014/06/Conway_s_Life-300x199.png" width="300" height="199" srcset="/images/uploads/2014/06/Conway_s_Life-300x199.png 300w, /images/uploads/2014/06/Conway_s_Life-1024x679.png 1024w, /images/uploads/2014/06/Conway_s_Life.png 1422w" sizes="(max-width: 300px) 100vw, 300px"></a></p>
<p>Before I get into Conway&#8217;s Life (the main thrust of this blog post), let me briefly comment on why open-ended assignments are the way to go when it comes to job interviews:</p>
<ul>
<li>Do you want to see how well someone can bullshit? Or do you want to see how well they can code?</li>
<li>Assigning a project measures not only technical prowess, but dedication and interest in the position</li>
<li>Instead of assessing how well someone will do on tasks tangentially related to the position, why not see how well they&#8217;ll actually do with something more real-world?</li>
<li>Best of all, it&#8217;s fun</li>
</ul>
<p>Of the three interviews in which I was given projects, two were open-ended. Of the two, my favorite one was this: &#8220;Build an implementation of Conway&#8217;s Game of Life&#8221;.</p>
<p>In a nutshell, Conway&#8217;s Life is a programming exercise in which a grid of cells is implemented. Each cell can be either on or off. The number of adjacent cells which are &#8220;on&#8221; determines whether or not a given cell is toggled on during each &#8220;turn&#8221;. This simple logic can result in fairly complicated patterns emerging from an extremely simple starting point.</p>
<p>My implementation was written in Javascript and HTML.</p>
<h2 id="Check-it-out-by-visiting-this-page-and-clicking-Play"><a href="#Check-it-out-by-visiting-this-page-and-clicking-Play" class="headerlink" title="Check it out by visiting this page and clicking Play."></a><strong>Check it out by visiting <a href="http://www.dan24678/js/life-program/index.htm" target="_blank">this page</a> and clicking Play.</strong></h2><p>Here are a few interesting points about my design:</p>
<ul>
<li>I split the design into two modules. The <a href="https://github.com/DrLongGhost/life-program/blob/master/src/life.js" target="_blank"><strong>life</strong></a> class implements an internal state of the Life board and the <a href="https://github.com/DrLongGhost/life-program/blob/master/src/lifedom.js" target="_blank"><strong>lifedom</strong></a> class handles exposing this state via the DOM.</li>
<li>The animation in <strong>lifedom</strong> works by toggling the background of the table cells on and off. Originally, the animation was so fast that I actually needed to slow it down (via setTimeout) to create a more aesthetically appealing effect. I added a slider that lets you slow down or speed up the animation by changing the value of the timeout.</li>
<li>I added unit tests. They make sense for the <strong>life</strong> class, less so for <strong>lifedom</strong>, so I got lazy as I added various bells and whistles to the latter.</li>
<li>Because I originally wanted tests for <strong>lifedom</strong>, it lead me to a regrettable design decision: there is HTML in the javascript. I wanted to avoid duplication and only define the HTML of the game board once. Generally speaking, there are 3 ways to do this: <ul>
<li>Use PHP to define an HTML template to use in both the unit tests and the application. <strong>Pro:</strong> Easy. <strong>Con:</strong> Requires PHP.</li>
<li>Use Javascript for the template. <strong>Pro:</strong> Easy. <strong>Con:</strong> Ugly. Clunky.</li>
<li>Use Grunt to manage different builds for test versus production. <strong>Pro:</strong> Best pure javascript solution. <strong>Con:</strong> More complicated than the alternatives.</li>
</ul>
</li>
</ul>
<h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><p>For me, the most interesting part of this project came shortly after I finished my first implementation. I decided to check it out on my 1st generation iPad Mini. The animation looked horrible. The &#8220;frame rate&#8221; was way too low and it looked visibly underpowered and stuttered. I tried reducing the timeout to try and speed things up, but this didn&#8217;t help: entire frames would be dropped and it still looked like shit.</p>
<p>It&#8217;s funny because I knew immediately how this would go down:</p>
<ul>
<li>I&#8217;d first trust my gut and try a quick fix</li>
<li>This wouldn&#8217;t work so I&#8217;d get more analytical and go through looking for additional optimizations</li>
<li>I would once again fail and resort to replacing the animation with canvas as a last ditch effort to get something that looked decent. I had no idea if this would work.</li>
</ul>
<p>My first attempt at better performance was to replace <strong>.toggleClass(&#8216;on off&#8217;)</strong> with direct manipulation of the backgroundColor property. My rationale was that this would avoid CSS repaints and perform better. I also added some caching of which cells were &#8220;on&#8221;, which avoided a jQuery <strong>find()</strong> operation. You can see the github changeset <a href="https://github.com/DrLongGhost/life-program/commit/aa1fedf3892dfe4d9526d789b02162a0015c4aaf" target="_blank">here</a>.</p>
<p>I added some basic benchmarking to measure the impact (or lack thereof) of this change. I created a running counter of &#8220;turns per second&#8221; which turned out to be a great benchmark. The less the animation slowed down the program, the higher the turns per second would be.</p>
<p>To measure each change, I used the R-Pentomino pattern and grabbed my benchmark at turn 150, which represents a peak for the pattern in terms of the number of enabled cells in the pattern (and consequent steep drop in animation performance on the iPad Mini). By comparing the Baseline/Control stats against a Test Run that has all the animation suppressed (such that each turn is calculated in the <strong>life</strong> class but never displayed on-screen) you can see how much the animation itself actually slows things down.</p>
<h2 id="Baseline-Control-Stats"><a href="#Baseline-Control-Stats" class="headerlink" title="Baseline/Control Stats"></a>Baseline/Control Stats</h2><ul>
<li>Chrome on Macbook: 16tps</li>
<li>iOS Simulator on Macbook: 16tps</li>
<li>iPad Mini (1st generation): 5tps</li>
<li>iPhone 5S: 14tps</li>
</ul>
<h2 id="Animation-Disabled"><a href="#Animation-Disabled" class="headerlink" title="Animation Disabled"></a>Animation Disabled</h2><ul>
<li>Chrome on Macbook: 19tps</li>
<li>iOS Simulator on Macbook: 19tps</li>
<li>iPad Mini (1st generation): 17tps</li>
<li>iPhone 5S: 18tps</li>
</ul>
<p>Next, we see the impact of my first attempt at improving the animation performance by replacing <strong>toggleClass(&#8216;on off&#8217;)</strong> with <strong>backgroundColor</strong>. It helped, but not enough.</p>
<h2 id="Classes-Removed"><a href="#Classes-Removed" class="headerlink" title="Classes Removed"></a>Classes Removed</h2><ul>
<li>Chrome on Macbook: 18tps</li>
<li>iOS Simulator on Macbook: 19tps</li>
<li>iPad Mini (1st generation): 7tps</li>
<li>iPhone 5S: 16tps</li>
</ul>
<p>I tried some additional optimizations which didn&#8217;t really do much:</p>
<ul>
<li>Instead of turning the entire board off and then turning cells on, figure out which ones should remain on and don&#8217;t turn them off in the first place: <a href="https://github.com/DrLongGhost/life-program/commit/b3b7c51c0bf1b4bdc4fc5154c915769ff85fe1f1" target="_blank">commit</a>.</li>
<li>Keep the internal array state of <strong>life</strong> sorted so we iterate less: <a href="https://github.com/DrLongGhost/life-program/commit/173017b777608c0be70b657e865c9e35c8e51c4b#diff-75e67dc61ab59dcd658eda3bf02a2023L154" target="_blank">commit</a>.</li>
<li>Replace <strong>document.getElementById</strong> with a cache so it only gets called the first time: <a href="https://github.com/DrLongGhost/life-program/commit/3cbb4626ef6382fe796b72df424feda311ffd5bc" target="_blank">commit</a>. This last change made a tiny difference, at least on the iPhone.</li>
</ul>
<h2 id="Cached-DOM-Lookups"><a href="#Cached-DOM-Lookups" class="headerlink" title="Cached DOM Lookups"></a>Cached DOM Lookups</h2><ul>
<li>Chrome on Macbook: 18tps</li>
<li>iOS Simulator on Macbook: 19tps</li>
<li>iPad Mini (1st generation): 7tps</li>
<li>iPhone 5S: 17tps</li>
</ul>
<p>At this point, I knew my only hope of getting acceptable performance would be to drop the idea of using a <table> altogether and swap out the table with a <canvas> when the user clicks Play and use that for the animation (<a href="https://github.com/DrLongGhost/life-program/commit/f24eb6da258e9dfba76af9155821636891704661" target="_blank">changeset here</a>). The results were pretty interesting and gratifying. Most importantly, it gets performance to an acceptable level on the iPad Mini.</canvas></table></p>
<h2 id="Canvas-Animation"><a href="#Canvas-Animation" class="headerlink" title="Canvas Animation"></a>Canvas Animation</h2><ul>
<li>Chrome on Macbook: 18tps</li>
<li>iOS Simulator on Macbook: 19tps</li>
<li>iPad Mini (1st generation): 11tps</li>
<li>iPhone 5S: 16tps</li>
</ul>
<p>By reducing the timeout value, I&#8217;m able to get the turns per second higher on an iPad without dropping frames. Note how it actually performs slightly worse on an iPhone 5S. Even on my iPad Mini, canvas actually starts out worse than the <table> solution (peaking at 17tps versus 18tps) before eventually overtaking it by turn 150.</table></p>
<p>If I were motivated to work on performance more, I might consider coding something that turns the timeout value down dynamically to respond to a low tps value. This would allow a consistent animation speed on both overpowered and underpowered devices &#8212; you would set the desired tps, rather than setting the timeout interval.</p>
<h2 id="What-8217-s-Next"><a href="#What-8217-s-Next" class="headerlink" title="What&#8217;s Next"></a>What&#8217;s Next</h2><p>I&#8217;m happy with the performance aspect of my program at this point. I might eventually add some drag and drop functionality so you can drag gliders, lines, pentominos, etc. onto the game board to more easily build complex patterns. I also toyed with the idea of adding different colors to the animation such that areas of the game board which are more busy would be colored darker than the parts which are burned out.</p>
<p>If you&#8217;re bored, feel free to fork my implementation, add something cool and send me a pull request.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/06/04/2014-06-04-conways-game-of-life/" data-id="ckurjqthe000ldas1cdjcd4kc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2014-02-28-runaway-intervals-stuck-shut-off-valves-and-nacho-cheese" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="dan24678/2014/02/28/2014-02-28-runaway-intervals-stuck-shut-off-valves-and-nacho-cheese/" class="article-date">
  <time datetime="2014-02-28T18:11:27.000Z" itemprop="datePublished">2014-02-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="dan24678/2014/02/28/2014-02-28-runaway-intervals-stuck-shut-off-valves-and-nacho-cheese/">Runaway Intervals, Stuck Shut-Off Valves and Nacho Cheese</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>&nbsp;</p>
<p>I had a pretty interesting bug come up at work a couple days ago. The bug itself and associated events illustrates several things: runaway setIntervals, why I love living on the East Coast, why you should sever connections to internal resources before hitting an external API, and, most of all, the sheer inventiveness of end users in finding any opportunity, however esoteric, to bring down your system.</p>
<p>Let&#8217;s start with the last one. This is one of my favorite things about where I currently work. I have the privilege of working for a company with a very large user base. Out of a total of over 100,000 customers, at any moment several thousand are logged into our site and cruising around, doing what they do. When you get into that large a number of people constantly hammering on your code, it tends to turn up really weird, obscure bugs that you never in a million years would have uncovered on your own, no matter how much testing you do pre-release. Here&#8217;s a contrived example&#8230;</p>
<p>Let&#8217;s say you have a contact form where a customer types a review of one of your products and you have some javascript that monitors what they type and periodically fires off Ajax requests. You may have tested it six ways to Sunday, using unit tests, integration tests, focus groups, the works. But once you unleash it into the wild, if you have a big enough install base, eventually you get someone like Adrian. Adrian is a Norwegian expatriate living in Japan who wants to enter a negative review of one of your nose hair trimmers. He&#8217;s seriously pissed off because that thing HURTS. While he types out his caustic review, he&#8217;s eating Nachos and drinking a 2010 Simi Valley merlot. He&#8217;s on his third glass and feeling a little tipsy. Before you know it, Adrian passes out after dripping Nacho cheese all over his keyboard, making it get stuck in a loop while typing the Japanese characters for pain (I was going to include them here parenthetically but WordPress converts them to question marks, so I&#8217;ll have to describe them for you instead. The first character looks like a fat guy in a bus stop; the second one is a kind of cursive capital H). Anyway, your javascript doesn&#8217;t like the fact that these keys have been depressed for over an hour and bad things happen. Now ask yourself&#8230; how could you possibly have anticipated this? Why would anyone ever intentionally keep a key down that long? Plus, what kind of person mixes red wine with nachos? I mean, it&#8217;s common knowledge you go with white wine when eating fish or cheese.</p>
<p>Anyway, it was someone like Adrian who almost caused a site outage for us last week. We use memcached as a caching mechansim on our site and our Dev Ops guys noticed a climbing number of connections from a couple of our servers. I started to look into the issue but then my wife called me and told me a pipe had burst at our house. We live near Philadelphia and we&#8217;d had single-digit temperatures for a couple days straight, resulting in a short piece of pipe on the outside of our house going to a hose faucet freezing up and bursting. I knew Dev Ops had the situation under control so I cleared it with my boss, and headed home to deal with my plumbing issue.</p>
<p>A helpful neighbor had alerted my wife to the problem; he&#8217;d then come inside and tried to close the valve leading to the faucet, but it was rusted shut, so he had closed the main shut-off instead. I couldn&#8217;t close the valve either to be able to safely turn the water back on, so I drained the pipes and took off the bottom half of the stuck valve. It was crazy old but I figured I might be able to get a replacement for just that piece and not have to pay a plumber to solder a new shut-off into place. I spent an hour going to both Lowe&#8217;s and Home Depot, but neither of them had the part &#8212; not surprising since Eisenhower was probably president when it was installed. Luckily, the one sales associate recommended I try some <a href="http://www.amazon.com/gp/product/B00200MR8Q/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=B00200MR8Q&amp;linkCode=as2&amp;tag=drlogh-20" target="_blank" rel="noopener">liquid wrench</a>. After soaking the valve in the oil for five minutes, I was able to ease it closed, letting me close off the line to the broken faucet and turn the water back on to the rest of the house.</p>
<p>Which leads me to why I love living on the East Coast. I&#8217;m the type of person who needs four seasons to be happy. The brutal, painful, freezing cold of winter makes you appreciate summer all the more. I don&#8217;t understand how anyone can live in L.A. &#8212; warm weather all the time, women walking around in short-shorts in the middle of December, seeing celebrities when you stop by the mall to buy a new nose hair trimmer. Who wants to live like that? I&#8217;ll take pipes exploding and knuckles cracking open from the cold any day, since it means I never take the Jersey shore for granted.</p>
<p>So I get back into work the next day, having resolved my plumbing emergency in a way that makes me feel like a true Man&#8217;s man (even though all I did was close a fucking valve) and Jimmy brings me up to speed on what went down.</p>
<p>Our website has a Facebook integration that allows customers to link their Facebook account up to our service. Apparently, Michelle  S. from Alabama had somehow managed to hammer away at our authorization endpoint 5 times per second for the better part of an hour. Before too long, this swamped memcached and brought us close to an outage, which Jimmy was able to avert by temporarily moving some data out of her account to silence the endpoint.</p>
<p>The nuts and bolts of what went wrong illustrates the right and wrong way to architect an endpoint that queries an external service. This particular endpoint assembles data from three different resources: our database, our memcached cluster and Facebook&#8217;s external API. There is a central design philosophy that you need to adhere to when working with this kind of system: sever all connections to your own internal resources before you open up any connection to an external API. Let&#8217;s say Facebook has issues on their end and calls to their endpoint don&#8217;t complete for 90 seconds. If you open a database connection to do some queries on your site and don&#8217;t bother to close it before issuing the API call to Facebook, that 90 seconds that you&#8217;re waiting on Facebook is an extra 90 seconds that that database connection is being held open. Multiply that by the number of people trying to use your Facebook integration at that particular moment. Then multiply it again by 2 or 3 to account for people getting fed up waiting and hitting refresh every five seconds to try and get the damn page to load.  Before you know it, your database connections are all gone, and your customers are seeing that hilarious graphic of the nerdy looking hamsters running around the colo cage that your design department came up with last week to display during a site outage.  Who knew it would come in handy so soon?</p>
<p>A prior outage had led us to ensure our code closes the database connections before querying Facebook, but we had neglected to do the same for memcached. Still, this wasn&#8217;t the only bug that had come into play; there was also a frontend bug that had caused those requests to hammer away at us, every 200ms like clockwork. And this illustrates another important point: Sometimes, when something goes wrong, if you dig deep enough, it&#8217;s actually several somethings. And you should find and fix them all.</p>
<p>Here&#8217;s how frontends for authorizing a Facebook application typically work. You click a link on the site and it pops open a new window displaying Facebook&#8217;s &#8220;authorize app&#8221; page. The javascript on the page uses setInterval to register a method to run every 200ms to check if the authorization pop-up has been closed. Once you click to authorize the app, the window closes and your Facebook profile can then be accessed via an ajax call to the integration endpoint. Here is some pseudo-code I wrote that shows the general process flow:</p>
<p><a href="/dan24678/images/uploads/2014/01/Web_-_sites_aweber_app_views_layouts_default_thtml_-_Aptana_Studio_3_-__Users_dand_Documents_Aptana_Studio_3_Workspace.png"><img class=" wp-image-137 alignnone" alt="Web_-_sites_aweber_app_views_layouts_default_thtml_-_Aptana_Studio_3_-__Users_dand_Documents_Aptana_Studio_3_Workspace" src="/dan24678/images/uploads/2014/01/Web_-_sites_aweber_app_views_layouts_default_thtml_-_Aptana_Studio_3_-__Users_dand_Documents_Aptana_Studio_3_Workspace.png" width="400" srcset="/images/uploads/2014/01/Web_-_sites_aweber_app_views_layouts_default_thtml_-_Aptana_Studio_3_-__Users_dand_Documents_Aptana_Studio_3_Workspace.png 1014w, /images/uploads/2014/01/Web_-_sites_aweber_app_views_layouts_default_thtml_-_Aptana_Studio_3_-__Users_dand_Documents_Aptana_Studio_3_Workspace-300x254.png 300w" sizes="(max-width: 1014px) 100vw, 1014px"></a></p>
<p>There&#8217;s some code that isn&#8217;t shown that opens the new window to Facebook&#8217;s auth page when you click on a button in the #Load-Facebook-Div and then calls the above init() method. So basically:</p>
<ol>
<li>Click a button in a DIV to open the new Facebook window</li>
<li>The init() method replaces the button with a loading message and polls every 200ms to see if the Facebook window is closed (meaning the auth happened).</li>
<li>Once the window has been closed, the interval is canceled and an ajax request is triggered to fetch the newly loaded Facebook profile details out of the database and show it on the page</li>
</ol>
<p>It seemed pretty obvious that the high frequency of the customer hammering on the endpoint implicated the 200ms setInterval call. But what exactly was going on? I looked closer at the code and noticed what appeared to be a minor race condition. We are storing the return value of the setInterval call in &#8220;this.interval&#8221; so we can cancel it later. But what happens if a second interval were created? The reference to the first interval would be overwritten and it would never be canceled and would keep firing forever. But how could I make this happen?</p>
<p>My first thought was that a double-click on the button might do it. Maybe the customer clicked it so fast that they snuck a second click in before the javascript could hide the button and prevent a second request. But no matter how fast I clicked on it, I couldn&#8217;t trigger this second request.</p>
<p>I briefly considered what would happen if a customer had two tabs open in their browser, loading this page twice and then clicked the Facebook integration on each one. But, I dismissed that, since each tab would have it&#8217;s own &#8220;window&#8221; object and maintain state independently.</p>
<p>In the end, I was able to make the Ajax request fire every 200ms by first clicking the link to start up an initial interval. Then I went into Chrome Dev Console and entered <strong>Namespace.facebookIntegration.init()</strong> to manually trigger a second setInterval that would overwrite the reference to the first. Sure enough, when I closed the Facebook window, the orphaned interval began hammering away on the endpoint.</p>
<p>I had proved that a lack of defensive programming on the frontend could result in a runaway interval that sent large amounts of traffic to our integration endpoint. But I still didn&#8217;t know exactly what Michelle S. in Alabama had done to uncover the bug. I&#8217;m going to assume that she didn&#8217;t de-minify our code, pour over it to find race conditions then open Chrome Dev Console and manually call the endpoint a second time just to fuck with us.</p>
<p>Even though I didn&#8217;t know exactly what caused the bug, I knew how to fix it. There are 2 ways actually:</p>
<ol>
<li>Try to cancel any pending interval before opening another one, rather than assuming it&#8217;s already been canceled</li>
<li>Make <strong>this.interval</strong> an array so it can support tracking multiple intervals. When the Facebook page is closed, clear <strong>all</strong> the intervals, rather than just the last one</li>
</ol>
<p>This frontend bug is a great example of a class of bugs which I rarely encounter and find somewhat frustrating when I do:  a bug that you are able to fix without fully understanding what&#8217;s causing it. It&#8217;s always better to have a complete understanding of the scope and progression of a problem to ensure that your solution adequately addresses everything that went wrong. But sometimes you simply can&#8217;t know for sure exactly what went down.</p>
<p>In the end, if you&#8217;re able to make your frontend code cleanly handle someone triggering hundreds of ajax lookups because a key on their keyboard is held depressed for over an hour, it really isn&#8217;t necessary to know that it was nacho cheese sauce that was holding down the key.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/02/28/2014-02-28-runaway-intervals-stuck-shut-off-valves-and-nacho-cheese/" data-id="ckurjqth5000gdas1e5v07zov" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2014-02-11-validanguage-and-node-js" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="dan24678/2014/02/11/2014-02-11-validanguage-and-node-js/" class="article-date">
  <time datetime="2014-02-11T13:57:11.000Z" itemprop="datePublished">2014-02-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="dan24678/2014/02/11/2014-02-11-validanguage-and-node-js/">Validanguage and Node.js</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>It&#8217;s been over 2 years since I last updated my <a href="http://www.dan24678/validanguage.php" target="_blank" rel="noopener">Validanguage</a> javascript library. In that time, several interesting trends emerged in the world of Javascript. One of them is the introduction of HTML 5&#8217;s <a href="http://diveintohtml5.info/forms.html" target="_blank" rel="noopener">form validation support</a>. Without getting into too much detail, I feel that HTML 5&#8217;s built-in validation is a good fit for many applications, but other sites will likely still benefit from a more full-featured form validation library. The second and third major trends in the past couple years has been the rise of Node.js and single-page web apps.</p>
<p>Validanguage was designed for the Web 2.0 world: websites that still use standard forms but augment them with occasional ajax requests to fetch supplemental data. In 2014, however, the bleeding edge has shifted to implementing entire sites as a single app within a framework such as <a href="http://backbonejs.org/" target="_blank" rel="noopener">Backbone.js</a>, <a href="http://emberjs.com/" target="_blank" rel="noopener">Ember</a> or <a href="http://angularjs.org/" target="_blank" rel="noopener">AngularJS</a>; and, often, doing away with forms entirely.</p>
<h3 id="Tentative-Roadmap"><a href="#Tentative-Roadmap" class="headerlink" title="Tentative Roadmap"></a>Tentative Roadmap</h3><ul>
<li>Add a shitload of unit tests via Node.js/Grunt/Jasmine/PhantomJS. Manual testing of new versions of Validanguage is excruciating and I need to automate this if I&#8217;m ever going to make progress on any eventual refactoring.</li>
<li>To fit within the context of a Node.js-based single-page web app, validation rules should be defined once (in a model). This model will then expose the validation rules for use on both the server and client. If the validation needs to change, you change it once in the model and both server and client are updated.</li>
<li>My vision for future versions of Validanguage is for it to retain its non-reliance on a particular framework. To the extent that it can be easily integrated into existing libraries or frameworks, I&#8217;ll see what I can do, but I&#8217;m not intending it to ever <strong>require</strong> Node.js, jQuery, Angular, etc.</li>
<li>Currently, Validanguage relies on form tags. I&#8217;d like to do away with this reliance and allow validation behavior to be defined on arbitrary &#8220;groups&#8221; of DOM elements/form controls.</li>
<li>Similarly, Validanguage is bound to a form control via DOM ID. I&#8217;d like it to support using arbitrary selectors as well.</li>
<li>Validanguage should be compatible with asynchronous loading and implemented as an AMD module.</li>
</ul>
<p>I&#8217;m starting with the first two bullet points. You can view my progress on <a href="https://github.com/DrLongGhost/Validanguage" target="_blank" rel="noopener">Validanguage&#8217;s github page</a>, which is finally seeing some action. I was very fortunate in my choice of JSON and HTML comments as the two methods for defining validation rules in Validanguage. Using Validanguage&#8217;s JSON API within a model on the backend (in Node.js) will work out perfectly. Validanguage middleware (installable via npm) can interpret and execute the rules to validate content posted to the server. To implement the rules client-side, custom helpers for Handlebars, Jade and other template languages can export the rules from the model into either script tags or the HTML markup in comment tags, which will play nicely with asynchronous loading. This approach works well in the CakePHP Validanguage helper I&#8217;d written years ago.</p>
<p>I&#8217;m really excited to see where this takes me. If you have any interest in collaborating with me, please make sure to <a href="http://www.dan24678/contact.php" target="_blank" rel="noopener">get in touch</a>. Now that I&#8217;m doing all new development against the github project, it should be pretty easy to team up with other interested developers to start moving this forward. As of last night, I have Jasmine installed in the Node project and I&#8217;m ready to start grinding out unit tests before getting started on the fun stuff.</p>
<p><a href="/dan24678/images/uploads/2014/02/Validanguage_—_bash_—_78×22_and_Oracle_VM_VirtualBox_Manager.png"><img class="aligncenter size-large wp-image-197" alt="Validanguage_—_bash_—_78×22_and_Oracle_VM_VirtualBox_Manager" src="/dan24678/images/uploads/2014/02/Validanguage_—_bash_—_78×22_and_Oracle_VM_VirtualBox_Manager-1024x664.png" width="640" height="415" srcset="/images/uploads/2014/02/Validanguage_—_bash_—_78×22_and_Oracle_VM_VirtualBox_Manager-1024x664.png 1024w, /images/uploads/2014/02/Validanguage_—_bash_—_78×22_and_Oracle_VM_VirtualBox_Manager-300x194.png 300w, /images/uploads/2014/02/Validanguage_—_bash_—_78×22_and_Oracle_VM_VirtualBox_Manager.png 1104w" sizes="(max-width: 640px) 100vw, 640px"></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/02/11/2014-02-11-validanguage-and-node-js/" data-id="ckurjqth3000edas1v92abukx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="dan24678/page/2/">2</a><a class="page-number" href="dan24678/page/3/">3</a><a class="extend next" rel="next" href="dan24678/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="dan24678/categories/Uncategorized/">Uncategorized</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2014/02/">February 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2014/01/">January 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2011/05/">May 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2011/04/">April 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2009/12/">December 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2009/10/">October 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2008/06/">June 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2008/04/">April 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2008/03/">March 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="dan24678/archives/2008/02/">February 2008</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="dan24678/2019/12/12/Useless-Stuff-I-Still-Know/">Useless Stuff I Still Know</a>
          </li>
        
          <li>
            <a href="dan24678/2017/07/13/2017-07-13-dont-let-your-buttons-overlap/">Dont Let Your Buttons Overlap</a>
          </li>
        
          <li>
            <a href="dan24678/2016/05/07/2016-05-07-campaign-error-logging-with-new-relic-insights/">Campaign Error Logging with New Relic Insights</a>
          </li>
        
          <li>
            <a href="dan24678/2016/04/17/2016-04-17-ms-7352-manual/">MS-7352 Manual</a>
          </li>
        
          <li>
            <a href="dan24678/2015/11/21/2015-11-21-connection-management/">Connection Management</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="dan24678/" class="mobile-nav-link">Home</a>
  
    <a href="dan24678/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="dan24678/fancybox/jquery.fancybox.css">
  <script src="dan24678/fancybox/jquery.fancybox.pack.js"></script>


<script src="dan24678/js/script.js"></script>



  </div>
</body>
</html>