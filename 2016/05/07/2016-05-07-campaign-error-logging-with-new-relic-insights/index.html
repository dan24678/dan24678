<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Campaign Error Logging with New Relic Insights | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Several weeks ago, a project which I&amp;#8217;d worked on for the better part of two months finally went live across all LeadiD customer campaigns. In many ways, I am prouder of this project than I am of">
<meta property="og:type" content="article">
<meta property="og:title" content="Campaign Error Logging with New Relic Insights">
<meta property="og:url" content="http://yoursite.com/2016/05/07/2016-05-07-campaign-error-logging-with-new-relic-insights/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Several weeks ago, a project which I&amp;#8217;d worked on for the better part of two months finally went live across all LeadiD customer campaigns. In many ways, I am prouder of this project than I am of">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/dan24678/images/uploads/2016/05/Insights__Campaign_JS-1024x537.png">
<meta property="og:image" content="http://yoursite.com/dan24678/images/uploads/2016/05/campaign_js_blog-300x274.png">
<meta property="og:image" content="http://yoursite.com/dan24678/images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence-300x232.png">
<meta property="og:updated_time" content="2021-10-14T22:51:43.776Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Campaign Error Logging with New Relic Insights">
<meta name="twitter:description" content="Several weeks ago, a project which I&amp;#8217;d worked on for the better part of two months finally went live across all LeadiD customer campaigns. In many ways, I am prouder of this project than I am of">
<meta name="twitter:image" content="http://yoursite.com/dan24678/images/uploads/2016/05/Insights__Campaign_JS-1024x537.png">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2016-05-07-campaign-error-logging-with-new-relic-insights" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/05/07/2016-05-07-campaign-error-logging-with-new-relic-insights/" class="article-date">
  <time datetime="2016-05-07T08:27:45.000Z" itemprop="datePublished">2016-05-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Campaign Error Logging with New Relic Insights
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Several weeks ago, a project which I&#8217;d worked on for the better part of two months finally went live across all LeadiD customer campaigns. In many ways, I am prouder of this project than I am of anything else I&#8217;ve done in the ten years or so that I&#8217;ve been doing web development &#8212; in large part because the finished product is just so damn cool.</p>
<p>Because I can&#8217;t help myself, I&#8217;m going to jump right to the pretty pictures. By leveraging the <a href="http://newrelic.com/insights" target="_blank" rel="noopener">Insights reporting backend</a> provided by New Relic, LeadiD now has access to a full dashboard that tracks all the errors and debug data associated with our customer&#8217;s campaign scripts:</p>
<p><a href="/dan24678/images/uploads/2016/05/Insights__Campaign_JS.png"><img class="aligncenter size-large wp-image-304" alt="Insights__Campaign_JS" src="/dan24678/images/uploads/2016/05/Insights__Campaign_JS-1024x537.png" width="640" height="335" srcset="/images/uploads/2016/05/Insights__Campaign_JS-1024x537.png 1024w, /images/uploads/2016/05/Insights__Campaign_JS-300x157.png 300w" sizes="(max-width: 640px) 100vw, 640px"></a></p>
<h2 id="Why-is-this-Cool"><a href="#Why-is-this-Cool" class="headerlink" title="Why is this Cool?"></a>Why is this Cool?</h2><p>Thousands of businesses use New Relic or their competitors to monitor their web sites and track errors. Why is what LeadiD did so interesting?</p>
<p>For the answer to this, you need to look at what it is we are actually monitoring. In order for LeadiD&#8217;s core services to operate, our customers must include the LeadiD campaign javascript on their site. Simply by including this script on the footer of their site, our customers gain unique insight and visibility into the actions and motivations of their site visitors. First and foremost, our javascript was written with two main areas of focus: performance and stability. Nonetheless, millions of individual consumers execute our javascript each day and some of those visits result in javascript errors. It is these errors which we are now monitoring.</p>
<p>Specifically, whenever an individual consumer triggers an error in our campaign javascript on any of the 20,000+ web domains who have partnered with LeadiD, we get a record of that error in our New Relic Insights dashboard, where the data is tracked and graphed so we can immediately see the impact as we push out new features or fix pre-existing bugs.</p>
<h2 id="How-Does-it-Work"><a href="#How-Does-it-Work" class="headerlink" title="How Does it Work?"></a>How Does it Work?</h2><p><a href="/dan24678/images/uploads/2016/05/campaign_js_blog.png"><img class="alignleft size-medium wp-image-318" alt="campaign_js_blog" src="/dan24678/images/uploads/2016/05/campaign_js_blog-300x274.png" width="300" height="274" srcset="/images/uploads/2016/05/campaign_js_blog-300x274.png 300w, /images/uploads/2016/05/campaign_js_blog.png 520w" sizes="(max-width: 300px) 100vw, 300px"></a>As shown in the diagram, a customer site AwesomeWalruses.com has implemented the LeadiD campaign javascript. Every time a visitor encounters an error in our script (or if debug logging, which I&#8217;ll discuss later, is enabled) a record is sent back to a logging microservice running on our domain. Typically, this request is sent as an asynchronous XmlHttpRequest from the client browser and includes all the available details about the error. From there, the microservice pushes the data into New Relic Insights.</p>
<p>One key item to note is that regular javascript errors on AwesomeWalruses.com are not reported back to our logging system. It is only errors in <span style="text-decoration: underline;"><strong>our</strong></span> campaign javascript which are being tracked.</p>
<p>To get this level of granularity, much of our campaign javascript is wrapped in try/catch blocks, instead of using the alternative method of binding to the global window.onerror handler. While the latter solution can likely provide a more sure method of capturing all errors, it is more risky and complicated when you consider the need to filter out errors from the parent site. Try/catch blocks, however, carry with them their own <a href="http://ryanmorr.com/reinventing-the-try-catch-block/" target="_blank" rel="noopener">performance considerations</a>.</p>
<p>One crucial feature which our campaign javascript now supports is a verbose debug logging setting. If this is enabled for a specific customer campaign, LeadiD receives javascript performance data from all visitors to a site, even if an error is never triggered. Because this is such a huge amount of data, the messages need to be batched together when they are sent to us and then unbatched in the microservice so each item is saved to New Relic separately. It&#8217;s interesting to note that enabling debug logging <span style="text-decoration: underline;"><strong>for a single customer</strong></span> triples our daily Insights data usage with New Relic (visible in the &#8220;Volume of Log Requests&#8221; graph above).</p>
<h2 id="Preliminary-Project-Design-and-Initial-Prototype"><a href="#Preliminary-Project-Design-and-Initial-Prototype" class="headerlink" title="Preliminary Project Design and Initial Prototype"></a>Preliminary Project Design and Initial Prototype</h2><p>When the project was first conceived, the specific backend where the logging data would be stored was an open question.</p>
<p>LeadiD was already using New Relic for server monitoring and <a href="https://raygun.com/" target="_blank" rel="noopener">RayGun</a> for application error logging. As a result, either service had the potential to be a good fit for this project. Additionally, I had previous experience with the open source project <a href="https://getsentry.com/welcome/" target="_blank" rel="noopener">Sentry</a> and, as a free software alternative to New Relic and RayGun, there were definite cost advantages to going with Sentry. As an additional free software alternative, we considered the <a href="https://www.elastic.co/products" target="_blank" rel="noopener">ELK stack</a> (ELK stands for Elastic Search, Logstash and Kibana).</p>
<p>With assistance from our first-rate Dev Ops team, I prototyped a backend that injected data into all the services except Elk, which we never tested due to the effort. (The prototype microservice was thankfully thrown away and reimplemented by Senior Engineer Ian Carpenter, which is what you hope for when you build a prototype). Next, we drew up a comparison table showing each choice&#8217;s strengths:</p>
<p style="text-align: center;"><br>  <a href="/images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence.png"><img class="aligncenter size-medium wp-image-308" alt="Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence" src="/dan24678/images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence-300x232.png" width="300" height="232" srcset="/images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence-300x232.png 300w, /images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence-1024x795.png 1024w, /images/uploads/2016/05/Campaign_JS_Logging_Backend_-_Engineering_-_LeadiD_Confluence.png 1110w" sizes="(max-width: 300px) 100vw, 300px"></a><br></p>

<p>To cut the chase, New Relic Insights was very compelling for 2 reasons:</p>
<ul>
<li>The ability to run SQL-like queries against the data and graph the results with very little work</li>
<li>As a SaaS-based solution, we save large amounts of time versus writing and maintaining our own solution</li>
</ul>
<p>One of the interesting realizations we had when comparing the chart above with our &#8220;technical requirements&#8221; was that error data and logging data are fundamentally two different things. Three of the four alternatives are more directly geared toward error data than storing normal application logging data, but New Relic Insights (which is essentially a NoSQL database masquerading as a relational one) proved itself able to be molded to fit both error messages <strong>and</strong> logging data. A few of the negatives to New Relic noted in the table ended up not mattering after all:</p>
<ul>
<li>The 256-character limit on tag length is mitigated by simply spreading your data across multiple fields</li>
<li>While we relinquish some control by having our error and logging data stored in New Relic&#8217;s system, the <a href="https://docs.newrelic.com/docs/insights/new-relic-insights/adding-querying-data/querying-your-data-remotely" target="_blank" rel="noopener">Insights API</a> allows integrations with this data. (I even wrote a script called <a href="https://github.com/DrLongGhost/insights2csv" target="_blank" rel="noopener">insights2csv</a> to easily pull down our data so we can import it into PostgreSQL and elsewhere)</li>
</ul>
<h2 id="The-Results"><a href="#The-Results" class="headerlink" title="The Results"></a>The Results</h2><p>LeadiD now has a system that allows us to monitor in real-time the impact of our client-side releases. This enables us to monitor new versions of our javascript as it goes live across all our customer sites and compare the volume of errors thrown by the new version against the historical norm from prior versions. If we begin seeing more errors than expected for the new version, we can immediately roll back the deployment and begin digging into the logging data itself to figure out what went wrong.</p>
<p>To this end, we can easily pull the data down from New Relic Insights to feed it into other databases to enable more advanced queries. This also facilitates resource sharing with our Data Science department, who are now able to use the data on which consumers encountered errors to exclude that problematic data from the datasets they use to train machine learning and develop scoring models.</p>
<p>Several specific examples of how LeadiD Engineering are using the Insights data are visible in the dashboard graphs above. We are now able to identify specific customer sites which are sending us high volumes of error data. It is far better for a company to proactively identify issues and reach out to its customers than it is for the company to fix the problem only after customers have noticed and complained. LeadiD is now in a position to notice any such errors before our customers do and before the errors have a chance to have a major negative impact on our products.</p>
<p>By partnering with client sites to run trials of the verbose debug logging, we have already identified several potential improvements to our libraries. Being able to follow the breadcrumbs left by the debug logging is an essential tool in keeping our scripts up-to-date with the latest browser APIs and in ensuring smooth co-existence with the various javascript frameworks in use today. Without this logging ability, it is an order of magnitude more difficult to even recognize that something is wrong, let alone figure out where in the code the problem may reside.</p>
<p>All in all, the finished Campaign JS Logging system has met or exceeded all the project goals. I had a lot of fun developing the finished solution and it continues to provide value to LeadiD and our customers on a daily basis.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/05/07/2016-05-07-campaign-error-logging-with-new-relic-insights/" data-id="ckurjoe0l000k45s1eewltk6i" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/07/13/2017-07-13-dont-let-your-buttons-overlap/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Dont Let Your Buttons Overlap
        
      </div>
    </a>
  
  
    <a href="/2016/04/17/2016-04-17-ms-7352-manual/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">MS-7352 Manual</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Uncategorized/">Uncategorized</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">December 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/01/">January 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/12/">December 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/10/">October 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/06/">June 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/04/">April 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/03/">March 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/02/">February 2008</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/12/12/Useless-Stuff-I-Still-Know/">Useless Stuff I Still Know</a>
          </li>
        
          <li>
            <a href="/2017/07/13/2017-07-13-dont-let-your-buttons-overlap/">Dont Let Your Buttons Overlap</a>
          </li>
        
          <li>
            <a href="/2016/05/07/2016-05-07-campaign-error-logging-with-new-relic-insights/">Campaign Error Logging with New Relic Insights</a>
          </li>
        
          <li>
            <a href="/2016/04/17/2016-04-17-ms-7352-manual/">MS-7352 Manual</a>
          </li>
        
          <li>
            <a href="/2015/11/21/2015-11-21-connection-management/">Connection Management</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>